(()=>{"use strict";var e={d:(t,o)=>{for(var n in o)e.o(o,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:o[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};e.d({},{e:()=>T});var t={formSelector:".popup__form",inputSelector:".popup__item",submitButtonSelector:".popup__save-button",inactiveButtonClass:"popup__save-button_disabled",inputErrorClass:"popup__item_type_error",errorClass:"popup__input-error_active"};function o(e){"Escape"===e.key&&document.querySelectorAll(".popup_opened").forEach((function(e){r(e)}))}function n(e){e.classList.add("popup_opened"),document.addEventListener("keydown",o)}function r(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",o)}var c={baseUrl:"https://mesto.nomoreparties.co/v1/plus-cohort-1",headers:{authorization:"020e494d-03bf-4222-970c-2fbceefd04a5","Content-Type":"application/json"}};function a(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}var u=["inputSelector","submitButtonSelector","inactiveButtonClass"],i=["formSelector"];function l(e,t){if(null==e)return{};var o,n,r=function(e,t){if(null==e)return{};var o,n,r={},c=Object.keys(e);for(n=0;n<c.length;n++)o=c[n],t.indexOf(o)>=0||(r[o]=e[o]);return r}(e,t);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(e);for(n=0;n<c.length;n++)o=c[n],t.indexOf(o)>=0||Object.prototype.propertyIsEnumerable.call(e,o)&&(r[o]=e[o])}return r}var p=function(e,t,o){var n=o.inputErrorClass,r=o.errorClass,c=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n),c.classList.remove(r),c.textContent=""},s=function(e,t,o,n,r){Array.from(e.querySelectorAll(t)).forEach((function(e){Array.from(e.querySelectorAll(o)).forEach((function(t){(""===t.value||""!==t.value&&t.validity.valid)&&p(e,t,{inputErrorClass:n,errorClass:r})}))}))},d=function(e,t,o){var n=Object.assign({},o);t.validity.valid?p(e,t,n):function(e,t,o,n){var r=n.inputErrorClass,c=n.errorClass,a=e.querySelector(".".concat(t.id,"-error"));t.classList.add(r),a.textContent=o,a.classList.add(c)}(e,t,t.validationMessage,n)},_=function(e,t,o,n,r){Array.from(e.querySelectorAll(o)).forEach((function(e){var o=Array.from(e.querySelectorAll(n));o.forEach((function(t){document.addEventListener("load",(function(){d(e,t)}))})),f(o,t,r)}))},f=function(e,t,o){!function(e,t,o){o?(e.classList.remove(t),e.removeAttribute("disabled")):(e.classList.add(t),e.setAttribute("disabled","disabled"))}(t,o,!function(e){return e.some((function(e){return!e.validity.valid}))}(e))},m=document.querySelector(".popup_type_open-photo"),v=m.querySelector(".popup__close-icon_close-photo"),y=document.querySelector(".popup_type_add-card"),h=y.querySelector(".popup__close-icon"),S=document.querySelector(".profile__add-button"),b=y.querySelector(".popup__save-button"),q=document.querySelector(".gallery"),g=document.querySelector('[name="add card form"]');function E(e,t){var o=document.querySelector("#card-template").content.querySelector(".gallery-item").cloneNode(!0);return o.querySelector(".gallery-item__signature").textContent=e.name,o.querySelector(".gallery-item__photo").src=e.link,o.querySelector(".gallery-item__photo").alt=e.name,function(e,t,o){var n=e.querySelector(".gallery-item__like-count"),r=e.querySelector(".gallery-item__like");n.textContent=t.likes.length,t.likes&&t.likes.some((function(e){return e._id===o._id}))&&r.classList.add("gallery-item__like_active"),r.addEventListener("click",(function(e){var r;t.likes&&t.likes.some((function(e){return e._id===o._id}))?(r=t._id,fetch("".concat(c.baseUrl,"/cards/likes/").concat(r),{method:"DELETE",headers:c.headers}).then((function(e){return a(e)}))).then((function(o){t.likes=o.likes,e.target.classList.remove("gallery-item__like_active"),n.textContent=o.likes.length})).catch((function(e){console.log(e)})):function(e){return fetch("".concat(c.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:c.headers}).then((function(e){return a(e)}))}(t._id).then((function(o){t.likes=o.likes,e.target.classList.add("gallery-item__like_active"),n.textContent=o.likes.length})).catch((function(e){console.log(e)}))}))}(o,e,t),function(e,t,o){if(o._id===t.owner._id){var n=document.createElement("button");n.classList.add("gallery-item__delete-card"),n.setAttribute("aria-label","удалить карточку"),n.setAttribute("type","button"),e.querySelector(".gallery-item__content-text").before(n),n.addEventListener("click",(function(){var e;(e=t._id,fetch("".concat(c.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:c.headers})).then((function(e){n.closest(".gallery-item").remove()})).catch((function(e){console.log(e)}))}))}}(o,e,t),o.querySelector(".gallery-item__photo").addEventListener("click",(function(t){t.stopPropagation(),function(e){var t=document.querySelector(".popup_type_open-photo");n(t);var o=t.querySelector(".popup__opened-image");o.src=e.link,o.alt=e.name,t.querySelector(".popup__image-signature").textContent=e.name}(e)})),o}function k(e,t,o){var n=E(e,o);t.prepend(n)}function L(e){e.preventDefault();var t,o,n=g.querySelector(".popup__item_type_place"),u=g.querySelector(".popup__item_type_link");b.textContent="Сохранение...",(t=n.value,o=u.value,fetch("".concat(c.baseUrl,"/cards"),{method:"POST",headers:c.headers,body:JSON.stringify({name:t,link:o})}).then((function(e){return a(e)}))).then((function(e){k(e,q,T),g.reset(),r(y)})).catch((function(e){console.log(e)})).finally((function(){b.textContent="Создать"}))}var C=document.querySelector(".popup_type_update-avatar"),x=C.querySelector(".popup__close-icon"),A=document.querySelector(".profile__edit-avatar-button"),O=document.querySelector(".profile__avatar"),P=C.querySelector('[name="update avatar form"]'),j=C.querySelector(".popup__item_type_link"),U=C.querySelector(".popup__save-button");O.addEventListener("mouseenter",(function(){A.classList.add("profile__edit-avatar-button_active")})),A.addEventListener("mouseleave",(function(){A.classList.remove("profile__edit-avatar-button_active")})),A.addEventListener("click",(function(){n(C);var e=C.querySelector(".popup__save-button");_(C,e,"popup__save-button_disabled"),s(C,".popup__form",".popup__item","popup__item_type_error","popup__input-error_active")})),x.addEventListener("click",(function(){r(C)}));var w=function(e){O.src=e};P.addEventListener("submit",(function(e){var t;e.preventDefault(),t=j.value,U.textContent="Сохранение...",function(e){return fetch("".concat(c.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:c.headers,body:JSON.stringify({avatar:e})}).then((function(e){return a(e)}))}(t).then((function(e){w(e.avatar),r(C)})).catch((function(e){console.log(e)})).finally((function(){U.textContent="Сохранить"})),P.reset()}));var T,B=document.querySelector(".popup_type_edit-profile"),D=document.querySelector(".profile__username"),N=document.querySelector(".profile__user-info"),J=B.querySelector(".popup__item_type_username"),H=B.querySelector(".popup__item_type_user-info"),z=B.querySelector('[name="profile edit form"]'),I=document.querySelector(".profile__edit-button"),M=B.querySelector(".popup__save-button");function F(){J.value=D.textContent,H.value=N.textContent,n(B),_(B,M,".popup__form",".popup__item","popup__save-button_disabled"),s(B,".popup__form",".popup__item","popup__item_type_error","popup__input-error_active")}function G(e){var t,o;e.preventDefault(),M.textContent="Сохранение...",(t=J.value,o=H.value,fetch("".concat(c.baseUrl,"/users/me"),{method:"PATCH",headers:c.headers,body:JSON.stringify({name:t,about:o})}).then((function(e){return a(e)}))).then((function(e){D.textContent=e.name,N.textContent=e.about,r(B)})).catch((function(e){console.log(e)})).finally((function(){M.textContent="Сохранить"}))}B.querySelector(".popup__close-icon").addEventListener("click",(function(){r(B)})),window.onload=function(){fetch("".concat(c.baseUrl,"/users/me"),{headers:c.headers}).then((function(e){return a(e)})).then((function(e){T=e})).then((function(){var e,o,p,E;e=T,D.textContent=e.name,N.textContent=e.about,z.addEventListener("submit",G),I.addEventListener("click",F),function(e){w(e.avatar)}(T),fetch("".concat(c.baseUrl,"/cards"),{headers:c.headers}).then((function(e){return a(e)})).then((function(e){e.reverse(),e.forEach((function(e){k(e,q,T)}))})).catch((function(e){console.log(e)})),v.addEventListener("click",(function(){r(m)})),S.addEventListener("click",(function(){n(y),_(y,b,".popup__form",".popup__item","popup__save-button_disabled"),s(y,".popup__form",".popup__item","popup__item_type_error","popup__input-error_active")})),g.addEventListener("submit",L),h.addEventListener("click",(function(){r(y)})),document.querySelectorAll(".popup").forEach((function(e){e.addEventListener("mousedown",(function(e){r(e.target),e.stopPropagation()}))})),p=(o=t).formSelector,E=l(o,i),Array.from(document.querySelectorAll(p)).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t){var o=t.inputSelector,n=t.submitButtonSelector,r=t.inactiveButtonClass,c=l(t,u),a=Array.from(e.querySelectorAll(o)),i=e.querySelector(n);f(a,i,r),a.forEach((function(t){t.addEventListener("input",(function(){d(e,t,c),f(a,i,r)}))}))}(e,E)}))}))}})();