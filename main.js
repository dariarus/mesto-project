(()=>{"use strict";var e={formSelector:".popup__form",inputSelector:".popup__item",submitButtonSelector:".popup__save-button",inactiveButtonClass:"popup__save-button_disabled",inputErrorClass:"popup__item_type_error",errorClass:"popup__input-error_active"},t=["inputSelector","submitButtonSelector","inactiveButtonClass"],o=["formSelector"];function n(e,t){if(null==e)return{};var o,n,r=function(e,t){if(null==e)return{};var o,n,r={},c=Object.keys(e);for(n=0;n<c.length;n++)o=c[n],t.indexOf(o)>=0||(r[o]=e[o]);return r}(e,t);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(e);for(n=0;n<c.length;n++)o=c[n],t.indexOf(o)>=0||Object.prototype.propertyIsEnumerable.call(e,o)&&(r[o]=e[o])}return r}var r=function(e,t,o){var n=o.inputErrorClass,r=o.errorClass,c=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n),c.classList.remove(r),c.textContent=""},c=function(e,t,o,n,c){Array.from(e.querySelectorAll(t)).forEach((function(e){Array.from(e.querySelectorAll(o)).forEach((function(t){(""===t.value||""!==t.value&&t.validity.valid)&&r(e,t,{inputErrorClass:n,errorClass:c})}))}))},u=function(e,t,o){var n=Object.assign({},o);t.validity.valid?r(e,t,n):function(e,t,o,n){var r=n.inputErrorClass,c=n.errorClass,u=e.querySelector(".".concat(t.id,"-error"));t.classList.add(r),u.textContent=o,u.classList.add(c)}(e,t,t.validationMessage,n)},a=function(e,t,o,n,r){Array.from(e.querySelectorAll(o)).forEach((function(e){var o=Array.from(e.querySelectorAll(n));o.forEach((function(t){document.addEventListener("load",(function(){u(e,t)}))})),i(o,t,r)}))},i=function(e,t,o){!function(e,t,o){o?(e.classList.remove(t),e.removeAttribute("disabled")):(e.classList.add(t),e.setAttribute("disabled","disabled"))}(t,o,!function(e){return e.some((function(e){return!e.validity.valid}))}(e))},l={baseUrl:"https://mesto.nomoreparties.co/v1/plus-cohort-1",headers:{authorization:"020e494d-03bf-4222-970c-2fbceefd04a5","Content-Type":"application/json"}};function s(){return fetch("".concat(l.baseUrl,"/users/me"),{headers:l.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}var p=document.querySelector(".gallery"),d=document.querySelector('[name="add card form"]');function _(e,t,o){var n=function(e,t){var o=document.querySelector("#card-template").content.querySelector(".gallery-item").cloneNode(!0),n=o.querySelector(".gallery-item__like-count");o.querySelector(".gallery-item__signature").textContent=e.name,o.querySelector(".gallery-item__photo").src=e.link,o.querySelector(".gallery-item__photo").alt=e.name,n.textContent=e.likes.length;var r=o.querySelector(".gallery-item__like");if(e.likes&&e.likes.some((function(e){return e._id===t._id}))&&r.classList.add("gallery-item__like_active"),r.addEventListener("click",(function(o){var r;e.likes&&e.likes.some((function(e){return e._id===t._id}))?(r=e._id,fetch("".concat(l.baseUrl,"/cards/likes/").concat(r),{method:"DELETE",headers:l.headers}).then((function(e){return e.json()}))).then((function(t){e.likes=t.likes,o.target.classList.remove("gallery-item__like_active"),n.textContent=t.likes.length})).catch((function(e){console.log(e)})):function(e){return fetch("".concat(l.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:l.headers}).then((function(e){return e.json()}))}(e._id).then((function(t){e.likes=t.likes,o.target.classList.add("gallery-item__like_active"),n.textContent=t.likes.length})).catch((function(e){console.log(e)}))})),t._id===e.owner._id){var c=document.createElement("button");c.classList.add("gallery-item__delete-card"),c.setAttribute("aria-label","удалить карточку"),c.setAttribute("type","button"),o.querySelector(".gallery-item__content-text").before(c),c.addEventListener("click",(function(){var t;(t=e._id,fetch("".concat(l.baseUrl,"/cards/").concat(t),{method:"DELETE",headers:l.headers})).then((function(e){c.closest(".gallery-item").remove()})).catch((function(e){console.log(e)}))}))}return o.querySelector(".gallery-item__photo").addEventListener("click",(function(){!function(e){var t=document.querySelector(".popup_type_open-photo");O(t);var o=t.querySelector(".popup__opened-image");o.src=e.link,o.alt=e.name,t.querySelector(".popup__image-signature").textContent=e.name}(e)})),o}(e,o);t.prepend(n)}var f=document.querySelector(".popup_type_edit-profile"),m=document.querySelector(".popup_type_open-photo"),v=m.querySelector(".popup__close-icon_close-photo"),y=document.querySelector(".popup_type_add-card"),h=y.querySelector(".popup__close-icon"),S=document.querySelector(".profile__username"),b=document.querySelector(".profile__user-info"),q=f.querySelector('[name="profile edit form"]'),g=f.querySelector(".popup__item_type_username"),E=f.querySelector(".popup__item_type_user-info"),k=document.querySelector(".profile__add-button"),L=f.querySelector(".popup__close-icon"),C=document.querySelector(".profile__edit-button"),x=f.querySelector(".popup__save-button"),A=y.querySelector(".popup__save-button");function j(e){"Escape"===e.key&&document.querySelectorAll(".popup_opened").forEach((function(e){P(e)}))}function O(e){e.classList.add("popup_opened"),document.addEventListener("keydown",j)}function P(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",j)}function U(){g.value=S.textContent,E.value=b.textContent,O(f),a(f,x,".popup__form",".popup__item","popup__save-button_disabled"),c(f,".popup__form",".popup__item","popup__item_type_error","popup__input-error_active")}function w(e){var t,o;e.preventDefault(),x.textContent="Сохранение...",(t=g.value,o=E.value,fetch("".concat(l.baseUrl,"/users/me"),{method:"PATCH",headers:l.headers,body:JSON.stringify({name:t,about:o})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){S.textContent=e.name,b.textContent=e.about})).catch((function(e){console.log(e)})).finally((function(){x.textContent="Сохранить"})),P(f)}k.addEventListener("click",(function(){O(y),a(y,A,".popup__form",".popup__item","popup__save-button_disabled"),c(y,".popup__form",".popup__item","popup__item_type_error","popup__input-error_active")})),L.addEventListener("click",(function(){P(f)})),h.addEventListener("click",(function(){P(y)})),d.addEventListener("submit",(function(e){e.preventDefault();var t,o,n=d.querySelector(".popup__item_type_place"),r=d.querySelector(".popup__item_type_link");A.textContent="Сохранение...",(t=n.value,o=r.value,fetch("".concat(l.baseUrl,"/cards"),{method:"POST",headers:l.headers,body:JSON.stringify({name:t,link:o})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){s().then((function(t){_(e,p,t)})).catch((function(e){console.log(e)})).finally((function(){A.textContent="Создать"}))})),d.reset(),P(y)})),q.addEventListener("submit",(function(e){e.preventDefault()}));var D=document.querySelector(".popup_type_update-avatar"),T=D.querySelector(".popup__close-icon"),B=document.querySelector(".profile__edit-avatar-button"),N=document.querySelector(".profile__avatar"),J=D.querySelector('[name="update avatar form"]'),H=D.querySelector(".popup__item_type_link"),z=D.querySelector(".popup__save-button");N.addEventListener("mouseenter",(function(){B.classList.add("profile__edit-avatar-button_active")})),B.addEventListener("mouseleave",(function(){B.classList.remove("profile__edit-avatar-button_active")})),B.addEventListener("click",(function(){O(D);var e=D.querySelector(".popup__save-button");a(D,e,"popup__save-button_disabled"),c(D,".popup__form",".popup__item","popup__item_type_error","popup__input-error_active")})),T.addEventListener("click",(function(){P(D)}));var I=function(e){N.src=e};J.addEventListener("submit",(function(e){var t;e.preventDefault(),t=H.value,z.textContent="Сохранение...",function(e){return fetch("".concat(l.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:l.headers,body:JSON.stringify({avatar:e})}).then((function(e){return e.json()}))}(t).then((function(e){I(e.avatar)})).catch((function(e){console.log(e)})).finally((function(){z.textContent="Сохранить"})),P(D),J.reset()})),window.onload=function(){var r,c,a;document.querySelectorAll(".popup").forEach((function(e){e.addEventListener("mousedown",(function(e){P(e.target),e.stopPropagation()}))})),v.addEventListener("click",(function(){P(m)})),document.querySelector(".popup__opened-photo-container").addEventListener("click",(function(e){e.stopPropagation()})),q.addEventListener("submit",w),C.addEventListener("click",U),s().then((function(e){S.textContent=e.name,b.textContent=e.about})).catch((function(e){console.log(e)})),s().then((function(e){I(e.avatar)})).catch((function(e){console.log(e)})),c=(r=e).formSelector,a=n(r,o),Array.from(document.querySelectorAll(c)).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),function(e,o){var r=o.inputSelector,c=o.submitButtonSelector,a=o.inactiveButtonClass,l=n(o,t),s=Array.from(e.querySelectorAll(r)),p=e.querySelector(c);i(s,p,a),s.forEach((function(t){t.addEventListener("input",(function(){u(e,t,l),i(s,p,a)}))}))}(e,a)})),s().then((function(e){fetch("".concat(l.baseUrl,"/cards"),{headers:l.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(t){t.forEach((function(t){_(t,p,e)}))})).catch((function(e){console.log(e)}))})).catch((function(e){console.log(e)}))}})();