(()=>{"use strict";var e={d:(t,o)=>{for(var n in o)e.o(o,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:o[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};e.d({},{e:()=>B});var t={formSelector:".popup__form",inputSelector:".popup__item",submitButtonSelector:".popup__save-button",inactiveButtonClass:"popup__save-button_disabled",inputErrorClass:"popup__item_type_error",errorClass:"popup__input-error_active"};function o(e){"Escape"===e.key&&document.querySelectorAll(".popup_opened").forEach((function(e){r(e)}))}function n(e){e.classList.add("popup_opened"),document.addEventListener("keydown",o)}function r(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",o)}var c={baseUrl:"https://mesto.nomoreparties.co/v1/plus-cohort-1",headers:{authorization:"020e494d-03bf-4222-970c-2fbceefd04a5","Content-Type":"application/json"}};function a(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}function u(){return fetch("".concat(c.baseUrl,"/users/me"),{headers:c.headers}).then((function(e){return a(e)}))}var i=["inputSelector","submitButtonSelector","inactiveButtonClass"],l=["formSelector"];function p(e,t){if(null==e)return{};var o,n,r=function(e,t){if(null==e)return{};var o,n,r={},c=Object.keys(e);for(n=0;n<c.length;n++)o=c[n],t.indexOf(o)>=0||(r[o]=e[o]);return r}(e,t);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(e);for(n=0;n<c.length;n++)o=c[n],t.indexOf(o)>=0||Object.prototype.propertyIsEnumerable.call(e,o)&&(r[o]=e[o])}return r}var s=function(e,t,o){var n=o.inputErrorClass,r=o.errorClass,c=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n),c.classList.remove(r),c.textContent=""},d=function(e,t,o,n,r){Array.from(e.querySelectorAll(t)).forEach((function(e){Array.from(e.querySelectorAll(o)).forEach((function(t){(""===t.value||""!==t.value&&t.validity.valid)&&s(e,t,{inputErrorClass:n,errorClass:r})}))}))},_=function(e,t,o){var n=Object.assign({},o);t.validity.valid?s(e,t,n):function(e,t,o,n){var r=n.inputErrorClass,c=n.errorClass,a=e.querySelector(".".concat(t.id,"-error"));t.classList.add(r),a.textContent=o,a.classList.add(c)}(e,t,t.validationMessage,n)},f=function(e,t,o,n,r){Array.from(e.querySelectorAll(o)).forEach((function(e){var o=Array.from(e.querySelectorAll(n));o.forEach((function(t){document.addEventListener("load",(function(){_(e,t)}))})),m(o,t,r)}))},m=function(e,t,o){!function(e,t,o){o?(e.classList.remove(t),e.removeAttribute("disabled")):(e.classList.add(t),e.setAttribute("disabled","disabled"))}(t,o,!function(e){return e.some((function(e){return!e.validity.valid}))}(e))},v=document.querySelector(".popup_type_open-photo"),y=v.querySelector(".popup__close-icon_close-photo"),h=document.querySelector(".popup_type_add-card"),S=h.querySelector(".popup__close-icon"),b=document.querySelector(".profile__add-button"),q=h.querySelector(".popup__save-button"),g=document.querySelector(".gallery"),E=document.querySelector('[name="add card form"]');function k(e,t){var o=document.querySelector("#card-template").content.querySelector(".gallery-item").cloneNode(!0);return o.querySelector(".gallery-item__signature").textContent=e.name,o.querySelector(".gallery-item__photo").src=e.link,o.querySelector(".gallery-item__photo").alt=e.name,function(e,t,o){var n=e.querySelector(".gallery-item__like-count"),r=e.querySelector(".gallery-item__like");n.textContent=t.likes.length,t.likes&&t.likes.some((function(e){return e._id===o._id}))&&r.classList.add("gallery-item__like_active"),r.addEventListener("click",(function(e){var r;t.likes&&t.likes.some((function(e){return e._id===o._id}))?(r=t._id,fetch("".concat(c.baseUrl,"/cards/likes/").concat(r),{method:"DELETE",headers:c.headers}).then((function(e){return a(e)}))).then((function(o){t.likes=o.likes,e.target.classList.remove("gallery-item__like_active"),n.textContent=o.likes.length})).catch((function(e){console.log(e)})):function(e){return fetch("".concat(c.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:c.headers}).then((function(e){return a(e)}))}(t._id).then((function(o){t.likes=o.likes,e.target.classList.add("gallery-item__like_active"),n.textContent=o.likes.length})).catch((function(e){console.log(e)}))}))}(o,e,t),function(e,t,o){if(o._id===t.owner._id){var n=document.createElement("button");n.classList.add("gallery-item__delete-card"),n.setAttribute("aria-label","удалить карточку"),n.setAttribute("type","button"),e.querySelector(".gallery-item__content-text").before(n),n.addEventListener("click",(function(){var e;(e=t._id,fetch("".concat(c.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:c.headers})).then((function(e){n.closest(".gallery-item").remove()})).catch((function(e){console.log(e)}))}))}}(o,e,t),o.querySelector(".gallery-item__photo").addEventListener("click",(function(t){t.stopPropagation(),function(e){var t=document.querySelector(".popup_type_open-photo");n(t);var o=t.querySelector(".popup__opened-image");o.src=e.link,o.alt=e.name,t.querySelector(".popup__image-signature").textContent=e.name}(e)})),o}function L(e,t,o){var n=k(e,o);t.prepend(n)}function C(e){e.preventDefault();var t,o,n=E.querySelector(".popup__item_type_place"),u=E.querySelector(".popup__item_type_link");q.textContent="Сохранение...",(t=n.value,o=u.value,fetch("".concat(c.baseUrl,"/cards"),{method:"POST",headers:c.headers,body:JSON.stringify({name:t,link:o})}).then((function(e){return a(e)}))).then((function(e){L(e,g,B)})).catch((function(e){console.log(e)})).finally((function(){q.textContent="Создать"})),E.reset(),r(h)}var x=document.querySelector(".popup_type_update-avatar"),A=x.querySelector(".popup__close-icon"),O=document.querySelector(".profile__edit-avatar-button"),P=document.querySelector(".profile__avatar"),j=x.querySelector('[name="update avatar form"]'),U=x.querySelector(".popup__item_type_link"),w=x.querySelector(".popup__save-button");P.addEventListener("mouseenter",(function(){O.classList.add("profile__edit-avatar-button_active")})),O.addEventListener("mouseleave",(function(){O.classList.remove("profile__edit-avatar-button_active")})),O.addEventListener("click",(function(){n(x);var e=x.querySelector(".popup__save-button");f(x,e,"popup__save-button_disabled"),d(x,".popup__form",".popup__item","popup__item_type_error","popup__input-error_active")})),A.addEventListener("click",(function(){r(x)}));var T=function(e){P.src=e};j.addEventListener("submit",(function(e){var t;e.preventDefault(),t=U.value,w.textContent="Сохранение...",function(e){return fetch("".concat(c.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:c.headers,body:JSON.stringify({avatar:e})}).then((function(e){return a(e)}))}(t).then((function(e){T(e.avatar),r(x)})).catch((function(e){console.log(e)})).finally((function(){w.textContent="Сохранить"})),j.reset()}));var B,D=document.querySelector(".popup_type_edit-profile"),N=document.querySelector(".profile__username"),J=document.querySelector(".profile__user-info"),H=D.querySelector(".popup__item_type_username"),z=D.querySelector(".popup__item_type_user-info"),I=D.querySelector('[name="profile edit form"]'),M=document.querySelector(".profile__edit-button"),F=D.querySelector(".popup__save-button");function G(){H.value=N.textContent,z.value=J.textContent,n(D),f(D,F,".popup__form",".popup__item","popup__save-button_disabled"),d(D,".popup__form",".popup__item","popup__item_type_error","popup__input-error_active")}function K(e){var t,o;e.preventDefault(),F.textContent="Сохранение...",(t=H.value,o=z.value,fetch("".concat(c.baseUrl,"/users/me"),{method:"PATCH",headers:c.headers,body:JSON.stringify({name:t,about:o})}).then((function(e){return a(e)}))).then((function(e){N.textContent=e.name,B.textContent=e.about})).catch((function(e){console.log(e)})).finally((function(){F.textContent="Сохранить"})),r(D)}D.querySelector(".popup__close-icon").addEventListener("click",(function(){r(D)})),window.onload=function(){u().then((function(e){B=e})).then((function(){var e,s,k;N.textContent=B.name,J.textContent=B.about,I.addEventListener("submit",K),M.addEventListener("click",G),u().then((function(e){T(e.avatar)})).catch((function(e){console.log(e)})),fetch("".concat(c.baseUrl,"/cards"),{headers:c.headers}).then((function(e){return a(e)})).then((function(e){e.reverse(),e.forEach((function(e){L(e,g,B)}))})).catch((function(e){console.log(e)})),y.addEventListener("click",(function(){r(v)})),b.addEventListener("click",(function(){n(h),f(h,q,".popup__form",".popup__item","popup__save-button_disabled"),d(h,".popup__form",".popup__item","popup__item_type_error","popup__input-error_active")})),E.addEventListener("submit",C),S.addEventListener("click",(function(){r(h)})),document.querySelectorAll(".popup").forEach((function(e){e.addEventListener("mousedown",(function(e){r(e.target),e.stopPropagation()}))})),o(),s=(e=t).formSelector,k=p(e,l),Array.from(document.querySelectorAll(s)).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t){var o=t.inputSelector,n=t.submitButtonSelector,r=t.inactiveButtonClass,c=p(t,i),a=Array.from(e.querySelectorAll(o)),u=e.querySelector(n);m(a,u,r),a.forEach((function(t){t.addEventListener("input",(function(){_(e,t,c),m(a,u,r)}))}))}(e,k)}))}))}})();